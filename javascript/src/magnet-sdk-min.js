/*!*
     * @fileoverview Magnet Mobile Server SDK for JavaScript
     *
     * @version 2.3.1-SNAPSHOT
     */
!function(a){function b(a,b,c){return a.replace("{"+b+"}",c)}function c(a,b){return"&"+a+"="+("object"==typeof b?JSON.stringify(b):b)}function d(a,b){return a+"="+("object"==typeof b?JSON.stringify(b):b)}function e(a){return-1!=a.indexOf("[]")?a.replace("[]",""):a}function f(b,c,d,e){for(var g in b)b.hasOwnProperty(g)&&b[g]&&("undefined"!=typeof e&&"undefined"!=typeof e[g]&&(e[g].type=e[g].type.trim()),b[g].isMagnetModel&&b[g].attributes?b[g]=f(b[g].attributes,c,b[g]):a.Utils.isArray(b[g])?b[g]=f(b[g],c):"undefined"!=typeof e&&e[g]&&a.Utils.isDateType(e[g].type)?b[g]="string"==typeof b[g]?b[g]:a.Utils.dateToISO8601(b[g]):"undefined"!=typeof e&&e[g]&&"bytearray"==e[g].type?b[g]=a.Utils.stringToBase64(b[g]):c&&"undefined"!=typeof d&&d.schema[g]&&("_data"==d.schema[g].type||"binary"==d.schema[g].type)&&(b[g]=c.add(b[g].mimeType,b[g].val)));return b}a.Config={endpointUrl:"",logging:!0,storeCredentials:!1,debugMode:!1,sdkVersion:"2.3.1-SNAPSHOT"},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.Utils={isAndroid:"undefined"!=typeof navigator&&navigator.userAgent?/Android|webOS/i.test(navigator.userAgent):!1,isIOS:"undefined"!=typeof navigator&&navigator.userAgent?/iPhone|iPad|iPod/i.test(navigator.userAgent):!1,isMobile:"undefined"!=typeof navigator&&navigator.userAgent?/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent):!1,isNode:"undefined"!=typeof module&&module.exports&&"undefined"==typeof window,isCordova:"undefined"!=typeof navigator&&navigator.userAgent&&"undefined"!=typeof window&&window.location&&window.location.href&&("undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap)&&/^file:\/{3}[^\/]/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android/i.test(navigator.userAgent),mergeObj:function(a,b){var a=a||{},b=b||{};for(var c in b)try{a[c]=b[c].constructor==Object?this.mergeObj(a[c],b[c]):b[c]}catch(d){a[c]=b[c]}return a},isObject:function(a){return"[object Object]"==Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},objectToFormdata:{stringify:function(b){if(a.Utils.isObject(b)){var c=[];for(var d in b)b.hasOwnProperty(d)&&null!=b[d]&&c.push(d+"="+encodeURIComponent(b[d]));return c.join("&")}return""}},getAttributes:function(a){var b=[];a=a||{};for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},isEmptyObject:function(a){if(!a||"string"==typeof a||"boolean"==typeof a||this.isNumeric(a))return!0;if(a.hasOwnProperty){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}for(var b in a)return!1;return!0},convertHeaderStrToObj:function(a){var b={};if(Object.keys(a).forEach)Object.keys(a).forEach(function(c){"string"!=typeof a[c]&&"number"!=typeof a[c]&&"boolean"!=typeof a[c]||"responseText"==c||(b[c]=a[c])});else for(var c in a)"string"!=typeof a[c]&&"number"!=typeof a[c]&&"boolean"!=typeof a[c]||"responseText"==c||(b[c]=a[c]);var d=a.getAllResponseHeaders().split("\n");for(var e in d){var c=d[e].trim().split(": ");c.length>1&&(b[c[0]]=c[1])}return b},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},validate:function(b,c,d){var e,f=[];c=c||{};for(var g in b)if(b.hasOwnProperty(g)){e={attribute:g};var h=b[g].type;"undefined"!=typeof b&&"undefined"!=typeof b[g]&&"undefined"!=typeof b[g].type&&(h=h.trim()),b[g].optional!==!1||"undefined"!=typeof c[g]&&""!==c[g]?!c[g]||"integer"!=h&&"biginteger"!=h&&"bigdecimal"!=h&&"double"!=h&&"long"!=h&&"float"!=h&&"short"!=h&&"byte"!=h||a.Utils.isNumeric(c[g])?c[g]&&"boolean"==h&&"true"!==c[g]&&c[g]!==!0&&"false"!==c[g]&&c[g]!==!1?e.reason="not boolean":!c[g]||"java.util.List"!=h&&"array"!=h||c[g]&&0!=c[g].length&&this.isArray(c[g])!==!1?!c[g]||"_data"!=h&&"binary"!=h||c[g].mimeType&&c[g].val||(e.reason="invalid binary format"):e.reason="empty list":e.reason="not numeric":d||(e.reason="required field blank"),e.reason&&f.push(e)}return 0==f.length?!1:f},isPrimitiveType:function(a){return-1!="|byte|short|int|long|float|double|boolean|char|string|integer|void|".indexOf("|"+a+"|")},getArrayType:function(a){return-1!=a.indexOf("[]")?a.slice(0,-2):!1},getDataType:function(a){var b;switch(Object.prototype.toString.call(a)){case"[object Number]":b="integer";break;case"[object String]":b="string";break;case"[object Array]":b="array";break;case"[object Object]":b="object";break;case"[object Date]":b="date";break;case"[object Boolean]":b="boolean"}return b},isDateType:function(a){return-1!="|date|".indexOf("|"+a+"|")==!0},isBinaryType:function(a){return-1!="|binary|_data|".indexOf("|"+a+"|")==!0},isGenericObject:function(a){return-1!="|object|".indexOf("|"+a+"|")==!0},isModelOrCollection:function(b){return a.Models[b]||a.Models[this.getArrayType(b)]?!0:!1},dateToISO8601:function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"},ISO8601ToDate:function(b){if("string"!=typeof b)return!1;var c=/(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d):(\d\d))/,d=[];if(d=b.match(c),!d)return a.Log("Couldn't parse ISO 8601 date string '"+b+"'"),!1;var e=[1,2,3,4,5,6,10,11];for(var f in e)d[e[f]]=parseInt(d[e[f]],10);d[7]=parseFloat(d[7]);var g=Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]);if(d[7]>0&&(g+=Math.round(1e3*d[7])),"Z"!=d[8]&&d[10]){var h=60*d[10]*60*1e3;d[11]&&(h+=60*d[11]*1e3),"-"==d[9]?g-=h:g+=h}return new Date(g)},stringToBase64:function(a){return this.isNode===!0&&"undefined"!=typeof Buffer?new Buffer(a).toString("base64"):window.btoa(unescape(encodeURIComponent(a)))},base64ToString:function(a){return this.isNode===!0&&"undefined"!=typeof Buffer?new Buffer(a,"base64").toString("utf8"):decodeURIComponent(escape(window.atob(a)))}},a.Promise=function(){this.successes=[],this.failures=[]},a.Promise.prototype={successes:null,failures:null,status:"pending",args:null,_isPromise:!0,then:function(b,c){var d=new a.Deferred;return b&&this.successes.push({fn:b,defer:d}),c&&this.failures.push({fn:c,defer:d}),"resolved"===this.status?this.exec({fn:b,defer:d},this.args):"rejected"===this.status&&this.exec({fn:c,defer:d},this.args),d.promise},success:function(b){var c=new a.Deferred;return b&&this.successes.push({fn:b,defer:c}),"resolved"===this.status&&this.exec({fn:b,defer:c},this.args),this},error:function(b){var c=new a.Deferred;return b&&this.failures.push({fn:b,defer:c}),"rejected"===this.status&&this.exec({fn:b,defer:c},this.args),this},exec:function(b,c){setTimeout(function(){var d=b.fn.apply(null,c);a.Utils.isObject(d)&&d._isPromise&&b.defer.bind(d)},0)}},a.Deferred=function(){this.promise=new a.Promise},a.Deferred.prototype={promise:null,resolve:function(){var a=this.promise;a.args=arguments,a.status="resolved";for(var b=0;b<a.successes.length;++b)a.exec(a.successes[b],a.args)},reject:function(){var a=this.promise;a.args=arguments,a.status="rejected";for(var b=0;b<a.failures.length;++b)a.exec(a.failures[b],a.args)},bind:function(a){var b=this;a.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)})}},a.Deferred.all=function(){for(var b=new a.Deferred,c=[],d=[],e=0,f=arguments.length,g=0;f>g;++g)arguments[g].call(null).then(function(){c.push(arguments),++e==f&&b.resolve(c,d)},function(){d.push(arguments),++e==f&&b.resolve(c,d)});return b.promise},a.Events={create:function(a){return a._events||a.invoke||a.on||a.unbind?!1:(a._events={},a.on=function(b,c){a._events[b]=a._events[b]||[],a._events[b].push(c)},a.invoke=function(b){if(typeof b==typeof[]){for(var c=b.length;c--;)if(a._events[b[c]])for(var d=a._events[b[c]].length;d--;)a._events[b[c]][d].apply(this,[].slice.call(arguments,1))}else if(a._events[b])for(var e=a._events[b].length;e--;)a._events[b][e].apply(this,[].slice.call(arguments,1))},a.unbind=function(b){a._events[b]&&delete a._events[b]},!0)}},a.Log=function(){a.Config.logging===!0&&console.log("[MAGNET DEBUG] ",a.Utils.isAndroid||a.Utils.isIOS?JSON.stringify(arguments)||arguments:arguments)},a.set=function(b){for(var c in b)if(b.hasOwnProperty(c)){if("endpointUrl"==c&&/^(ftp|http|https):/.test(b[c]===!1))throw"invalid endpointUrl - no protocol";a.Config[c]=b[c]}return this},a.reset=function(){return a.set({endpointUrl:"",logging:!0}),this},a.define=function(b){var c=require(b),d=c.Controllers?"Controllers":"Models";return a.Utils.mergeObj(a[d],c[d]),this},a.Transport={request:function(b,c,d,e,f){if(d=d||{},c._path=c._path||c.path,a.Config.endpointUrl=a.Config.endpointUrl.toLowerCase(),c._path=c.local===!0||/^(ftp|http|https):/.test(c._path)===!0?c._path:a.Config.endpointUrl+c._path,a.Utils.isNode)this.initNodeRequest(b,c,d,e,f);else if("undefined"==typeof jQuery||a.Utils.isBinaryType(c.returnType)||c.isBinary){if("undefined"===XMLHttpRequest)throw"request-transport-unavailable";this.requestXHR(b,c,d,e,f)}else this.requestJQuery(b,c,d,e,f)},requestJQuery:function(b,c,d,e,f){var g=this,h=g.parseBody(c.contentType,b);$.support.cors=!0;var i={body:h,info:{url:c._path}};$.ajax({type:c.method,url:c._path,timeout:3e4,dataType:c.dataType,contentType:c.contentType,data:h,beforeSend:function(a){if(c.headers)for(var b=c.headers.length;b--;)a.setRequestHeader(c.headers[b].name,c.headers[b].val);a.setRequestHeader("Accept",g.createAcceptHeader(c.dataType))},success:function(b,c,d){typeof e==typeof Function&&(i.info.xhr=a.Utils.convertHeaderStrToObj(d),i.contentType=d.getResponseHeader("Content-Type"),i.status=d.status,b=b.result||b,e(b,i))},error:function(b,c){i.info.xhr=a.Utils.convertHeaderStrToObj(b),i.contentType=b.getResponseHeader("Content-Type"),i.status=b.status,"parsererror"==c?e(b.responseText,i):typeof f==typeof Function&&f(b.responseText,i)}})},requestXHR:function(b,c,d,e,f){var g,h=this,i=h.parseBody(c.contentType,b),j={body:i,info:{url:c._path}},k=new XMLHttpRequest;if(k.timeout=3e4,a.Utils.isBinaryType(c.returnType)&&k.overrideMimeType("text/plain; charset=x-user-defined"),k.onreadystatechange=function(){if(4==k.readyState){if(j.status=k.status,j.contentType=k.getResponseHeader("Content-Type"),j.info.xhr=a.Utils.convertHeaderStrToObj(k),g=k.responseText,"undefined"!=typeof k.responseXML&&null!=k.responseXML)g=k.responseXML;else try{g=JSON.parse(g)}catch(b){}h.isSuccess(k.status)?(a.Utils.isBinaryType(c.returnType)&&(g={mimeType:j.contentType,val:g}),typeof e==typeof Function&&e(g,j)):typeof f==typeof Function&&f(g,j)}},k.ontimeout=function(){j.status=0,j.contentType=k.getResponseHeader("Content-Type"),j.info.xhr=a.Utils.convertHeaderStrToObj(k),typeof f==typeof Function&&f("request-timeout",j)},k.open(c.method,c._path,!0),c.contentType&&k.setRequestHeader("Content-Type",c.contentType),k.setRequestHeader("Accept",h.createAcceptHeader(c.dataType)),c.headers)for(var l=c.headers.length;l--;)k.setRequestHeader(c.headers[l].name,c.headers[l].val);k.send(i)},initNodeRequest:function(b,c,d,e,f){var g=require("url"),h=g.parse(c._path),i=a.Utils.mergeObj({"Content-Type":c.contentType},a.Transport.Headers);if(c.headers)for(var j=c.headers.length;j--;)i[c.headers[j].name]=c.headers[j].val;c.protocol=h.protocol,h.hostname?this.requestNode(b,c,{host:h.hostname,port:parseInt(h.port||("https:"==h.protocol?443:null)),path:h.path,method:c.method,rejectUnauthorized:!1,requestCert:!1,headers:i},d,e,f):typeof f==typeof Function&&f("error-parsing-url",{body:b,info:{url:c._path}})},requestNode:function(b,c,d,e,f,g){var h=this,i=require("http"),j=require("https"),k=h.parseBody(c.contentType,b);d.headers=d||{},d["Content-Length"]="GET"==d.method?0:k.length;var l=("https:"==c.protocol?j:i).request(d,function(b){var d="",e={body:k,info:{metadata:c,url:c._path,request:l,response:b},contentType:b.headers["content-type"],status:b.statusCode};b.setEncoding(a.Utils.isBinaryType(c.returnType)?"binary":"utf8"),b.on("data",function(a){d+=a}),b.on("end",function(){try{d=JSON.parse(d)}catch(i){}h.isSuccess(b.statusCode)?(a.Utils.isBinaryType(c.returnType)&&(d={mimeType:e.contentType,val:d}),typeof f==typeof Function&&f(d,e)):typeof g==typeof Function&&g(d,e)})});l.on("error",function(a){if(typeof g==typeof Function){var d={body:b,info:{metadata:c,url:c._path,request:l},status:0};g(a,d)}}),b&&l.write(k,c.isBinary===!0?"binary":"utf8"),l.end()},isSuccess:function(a){return a>=200&&299>=a},parseBody:function(b,c){var d=a.Utils.isNode?require("querystring"):a.Utils.objectToFormdata;switch(b){case"application/x-www-form-urlencoded":c=d.stringify(c);break;case"application/json":c=JSON.stringify(c)}return c},createAcceptHeader:function(a){var b="";switch(a=a||"json"){case"xml":b="application/xml;q=1.0";break;case"html":b="text/plain;q=1.0";break;case"text":b="text/plain;q=1.0";break;case"json":b="application/json;q=1.0";break;default:b="*/*;q=1.0"}return b}},a.Transport.Headers={},a.Request=function(a,b,c){this.instance=a,this.options=b,this.metadata=c},a.Request.prototype.send=function(b,c){var d=this;setTimeout(function(){d.metadata.params.contentType=d.metadata.params.contentType||(d.metadata.params.consumes?d.metadata.params.consumes[0]:void 0)||"application/json";var e=d.setup(d.metadata.schema||{},d.metadata.params,d.options.attributes);e.params.headers=e.params.headers||[],a.Transport.request(e.body,e.params,d.options,function(a,c){d.onResponseSuccess(b,a,c)},function(a,e){d.onResponseError(b,c,a,e)})},1)},a.Request.prototype.setup=function(e,g,h){var i="",j={},k={},l={},m="",n=!1;g.dataType=g.dataType||"json",g._path=g.baseUrl?g.baseUrl+g.path:g.path;var o=f(h,void 0,void 0,e);for(var p in o)if(o.hasOwnProperty(p)&&e[p])if("_data"!=e[p].type&&"binary"!=e[p].type||"undefined"!=typeof multipart)switch(e[p].style){case"TEMPLATE":g._path=b(g._path,p,o[p]);break;case"QUERY":i+=c(p,o[p]);break;case"PLAIN":"DELETE"===this.metadata.params.method||"GET"===this.metadata.params.method?i+=c(p,o[p]):k[p]=o[p];break;case"HEADER":g.headers=g.headers||[],g.headers.push({name:p,val:o[p]});break;case"MATRIX":g._path=b(g._path,p,d(p,o[p]));break;case"FORM":g.contentType="application/x-www-form-urlencoded","DELETE"===this.metadata.params.method||"GET"===this.metadata.params.method?i+=c(p,o[p]):l[p]=o[p]}else n=p;var q=a.Utils.getAttributes(k);return n?(g.isBinary=!0,g.contentType=o[n].mimeType,j=o[n].val):j=a.Utils.isEmptyObject(l)&&1==q.length?k[q[0]]:a.Utils.mergeObj(k,l),g._path=(g.basePathOnly===!0||g.baseUrl?g._path:"/rest"+g._path)+m+i,g._path=-1==g._path.indexOf("?")?g._path.replace("&","?"):g._path,{body:j,params:g}},a.Request.prototype.onResponseSuccess=function(a,b,c){var d=this;d.formatResponse(b,c,function(b){d.instance&&d.instance.invoke(["Complete","Success","MMSDKComplete"],d.metadata.params.name,b,c),typeof a==typeof Function&&a(b,c)})},a.Request.prototype.onResponseError=function(a,b,c,d){this.instance&&this.instance.invoke(["Complete","Error","MMSDKComplete"],this.metadata.params.name,c,d),typeof b==typeof Function&&b(c,d)},a.Request.prototype.formatResponse=function(b,c,d){var e=this.metadata.params,f=b;"date"==e.returnType?d(a.Utils.ISO8601ToDate(b)):this.options&&this.options.saveAs&&a.Utils.isCordova===!1?a.Utils.isNode?require("fs").writeFile(this.options.saveAs,"string"==typeof b?b:JSON.stringify(b),a.Utils.mergeObj({encoding:"binary",mode:438,flag:"w"},this.options.saveAsOptions),function(b){b&&a.Log(b),d(f)}):(a.Log("The saveAs option is only compatible with Phonegap or Node.js applications."),d(f)):d(a.Utils.isModelOrCollection(e.returnType)===!0?this.jsonToModel(e.returnType,b):a.Utils.isDateType(e.returnType)?a.Utils.ISO8601ToDate(f):"bytearray"==e.returnType?a.Utils.base64ToString(f):f)},a.Request.prototype.jsonToModel=function(b,c){var d=e(b);if(a.Models[d]&&-1!=b.indexOf("[]")&&c&&a.Utils.isArray(c))c=new a.Collection(d,c);else if(a.Models[d]&&a.Utils.isArray(c))for(var f=0;f<c.length;++f)c[f]=this.jsonToModel(d,c[f]);else if(a.Models[d]&&a.Utils.isObject(c)){c=new a.Models[d](c);for(var g in c.attributes)c.schema[g]&&(c.attributes[g]=this.jsonToModel(e(c.schema[g].type),c.attributes[g]))}else"bytearray"==d?c=a.Utils.base64ToString(c):a.Utils.isDateType(d)&&(c=a.Utils.ISO8601ToDate(c));return c},a.Model=function(b,c){a.Events.create(this),this.attributes=this.attributes||{};for(var d in this.attributes)null===this.attributes[d]&&delete this.attributes[d];return b&&this.set(b,c),this.isMagnetModel=!0,this},a.Model.prototype.validate=function(b,c){return a.Utils.validate(this.schema,b,c)},a.Model.prototype.set=function(b,c){if(c){var d=this.validate(b);return d===!1?(this.attributes=a.Utils.mergeObj(this.attributes,b),this.invoke("onSet",this.name,b)):a.Log('model "'+this.name+'" validation failure:'+JSON.stringify(d)),d?d:!1}return this.attributes=a.Utils.mergeObj(this.attributes,b),this.invoke("onSet",this.name,b),!1},a.Collection=function(b,c){return this._type=b,this.entityType=a.Models[this._type]?a.Models[this._type].entityType:b,this.models=[],c&&this.add(c),this.isMagnetCollection=!0,this},a.Collection.prototype.add=function(b){if(a.Utils.isArray(b))for(var c=0;c<b.length;++c)this.models.push(b[c].isMagnetModel?b[c]:new a.Models[this._type](b[c]));else this.models.push(b.isMagnetModel?b:new a.Models[this._type](b))},a.Collection.prototype.clear=function(){this.models=[]},a.Collection.prototype.where=function(b,c){for(var d=[],e=0;e<this.models.length;++e)if(a.Utils.isObject(b)){var f=!0;for(var g in b)b.hasOwnProperty(g)&&(this.models[e].attributes[g]&&this.models[e].attributes[g]===b[g]||(f=!1));f&&d.push(this.models[e])}else c&&this.models[e].attributes[b]===c&&d.push(this.models[e]);return d},a.Models={},a.Controller=function(b){return this._MMSDKName=b,a.Events.create(this),this},a.Method=function(b,c,d){var e=this;c=c||{},c.attributes="undefined"==typeof b||null===b?void 0:b,c.attributes=a.Utils.mergeObj(c.attributes,d.attributes);var f=a.Utils.validate(d.schema,c.attributes),g=new a.Deferred;if(g.promise=new a.Promise,c.call=g.promise,d.params.controller=e._MMSDKName,f===!1){e.invoke(["Set"],d.params.name,c,d);var h=new a.Request(e,c,d);e.invoke(["BeforeRequest"],d.params.name,c,d),h.send(function(){typeof c.success==typeof Function&&c.success.apply(e,arguments),g.resolve.apply(g,arguments)},function(){typeof c.error==typeof Function&&c.error.apply(e,arguments),g.reject.apply(g,arguments)})}else e.invoke(["Complete","Error"],d.params.name,"failed-validation",f),a.Log('controller method "'+d.params.name+'" validation failure:'+JSON.stringify(f)),typeof c.error==typeof Function&&c.error("failed-validation",f),g.reject("failed-validation",f);return g.promise},a.Controllers={},/*!
 *  window.btoa/window.atob shim
 */
function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=Error(),a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=0,g=c,h="";b.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&d>>8-8*(f%1))){if(e=b.charCodeAt(f+=.75),e>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return h}),b.atob||(b.atob=function(b){if(b=b.replace(/=+$/,""),1==b.length%4)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var d,e,f=0,g=0,h="";e=b.charAt(g++);~e&&(d=f%4?64*d+e:e,f++%4)?h+=String.fromCharCode(255&d>>(6&-2*f)):0)e=c.indexOf(e);return h})}()}("undefined"==typeof exports?this.MagnetJS||(this.MagnetJS={}):exports);